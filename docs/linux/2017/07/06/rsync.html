<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>rsync tutorial</title>
  <meta name="description" content="Install">
  
  <meta name="author" content="Peng Xiao">
  <meta name="copyright" content="&copy; Peng Xiao 2018">
  

  <!-- External libraries -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/monokai-sublime.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css">

  <!-- Favicon and other icons (made with http://www.favicon-generator.org/) -->
  <link rel="shortcut icon" href="/engineering/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/engineering/assets/icons/favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="/engineering/assets/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/engineering/assets/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/engineering/assets/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/engineering/assets/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/engineering/assets/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/engineering/assets/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/engineering/assets/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/engineering/assets/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/engineering/assets/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/engineering/assets/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/engineering/assets/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/engineering/assets/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/engineering/assets/icons/favicon-16x16.png">
  <link rel="manifest" href="/engineering/assets/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/engineering/assets/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  
  <!-- Facebook OGP cards -->
  <meta property="og:description" content="Install" />
  <meta property="og:url" content="http://ciscochina.github.io" />
  <meta property="og:site_name" content="Cisco China ADC Engineering Blog" />
  <meta property="og:title" content="rsync tutorial" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="http://ciscochina.github.io/engineering/assets/logo.png" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="612" />
  <meta property="og:image:height" content="605" />
  

  
  <!-- Twitter: card tags -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="rsync tutorial">
  <meta name="twitter:description" content="Install">
  <meta name="twitter:image" content="http://ciscochina.github.io/engineering/assets/logo.png">
  <meta name="twitter:url" content="http://ciscochina.github.io">
  

  

  <!-- Site styles -->
  <link rel="stylesheet" href="/engineering/css/main.css">
  <link rel="canonical" href="http://ciscochina.github.io/engineering/linux/2017/07/06/rsync.html">
  <link rel="alternate" type="application/rss+xml" title="Cisco China ADC Engineering Blog" href="http://ciscochina.github.io/engineering/feed.xml" />
</head>


  <body>

    <header class="navigation" role="banner">
  <div class="navigation-wrapper">
    <a href="/engineering/" class="logo">
      
      <img src="/engineering/assets/logo.png" alt="Cisco China ADC Engineering Blog">
      
    </a>
    <a href="javascript:void(0)" class="navigation-menu-button" id="js-mobile-menu">
      <i class="fa fa-bars"></i>
    </a>
    <nav role="navigation">
      <ul id="js-navigation-menu" class="navigation-menu show">
        
          
          <li class="nav-link"><a href="/engineering/about/">About</a>
          
        
          
        
          
        
          
        
          
          <li class="nav-link"><a href="/engineering/blog/">Blogs</a>
          
        
          
          <li class="nav-link"><a href="/engineering/typography/">Typography</a>
          
        
          
        
          
        
      </ul>
    </nav>
  </div>
</header>


    <div class="page-content">
        <div class="post">

<div class="post-header-container " >
  <div class="scrim ">
    <header class="post-header">
      <h1 class="title">rsync tutorial</h1>
      <p class="info">by <strong>Peng Xiao</strong></p>
    </header>
  </div>
</div>

<div class="wrapper">

 <span class="page-divider">
  <span class="one"></span>
  <span class="two"></span>
</span>
 

<section class="post-meta">
  <div class="post-date">July 6, 2017</div>
  <div class="post-categories">
  in 
    
    <a href="/engineering/category/linux">Linux</a>
    
  
  </div>
</section>

<article class="post-content">
  <h2 id="install">Install</h2>

<p>Rsync is installed in many linux systems by default.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>rsync --version
rsync  version 3.0.9  protocol version 30
Copyright <span class="o">(</span>C<span class="o">)</span> 1996-2011 by Andrew Tridgell, Wayne Davison, and others.
Web site: http://rsync.samba.org/
Capabilities:
    64-bit files, 64-bit inums, 64-bit timestamps, 64-bit long ints,
    socketpairs, hardlinks, symlinks, IPv6, batchfiles, inplace,
    append, ACLs, xattrs, iconv, symtimes

rsync comes with ABSOLUTELY NO WARRANTY.  This is free software, and you
are welcome to redistribute it under certain conditions.  See the GNU
General Public Licence <span class="k">for </span>details.
</code></pre>
</div>

<h2 id="usage-example">Usage Example</h2>

<p>We want to sync folders from one host to another host, so there are a source host and a target host.</p>

<h3 id="target-host">Target host</h3>

<p>In target host we will start a rsync daemon process, it will listen on port 873 by default, and wait connection from the source host.
Once the connection is established, the source host will sync the folder/file to the target host.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>/usr/bin/rsync --daemon --config<span class="o">=</span>/etc/rsyncd/rsyncd.conf
</code></pre>
</div>

<p>Before that we should prepare some files located under <code class="highlighter-rouge">/etc/rsyncd/</code></p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">pwd</span>
/etc/rsyncd
<span class="gp">$ </span>ls -l
total 48
-rw-r--r-- 1 root root   664 Nov  2 13:41 rsyncd.conf
-rw------- 1 root root    17 Nov  2 13:41 rsyncd.password
</code></pre>
</div>
<p>For <code class="highlighter-rouge">rsyncd.password</code>, please make sure the read/write access only for the current user, and it contains the SSH user/password which will be used by
the source host.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>more rsyncd.password
demo:demo
</code></pre>
</div>
<p>For <code class="highlighter-rouge">rsyncd.conf</code></p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>more rsyncd.conf
uid <span class="o">=</span> root
gid <span class="o">=</span> root
user chroot <span class="o">=</span> no
max connections <span class="o">=</span> 50
timeout <span class="o">=</span> 180
pid file <span class="o">=</span> /etc/rsyncd/rsyncd.pid
lock <span class="nv">file</span><span class="o">=</span> /etc/rsyncd/rsyncd.lock
log file <span class="o">=</span> /etc/rsyncd/rsyncd.log
user chroot <span class="o">=</span> no
max connections <span class="o">=</span> 50
timeout <span class="o">=</span> 180

transfer logging <span class="o">=</span> yes
log format <span class="o">=</span> %t %a %m %f %b
syslog facility <span class="o">=</span> local3
secrets file <span class="o">=</span> /etc/rsyncd/rsyncd.password

<span class="o">[</span>target_folder]
<span class="nv">path</span><span class="o">=</span>/home/demo/target_folder/
ignore errors
hosts allow <span class="o">=</span>1.1.1.1
hosts deny <span class="o">=</span> <span class="k">*</span>
secrets file <span class="o">=</span> /etc/rsyncd/rsyncd.password
<span class="nb">read </span>only <span class="o">=</span> no
list <span class="o">=</span> no
auth users <span class="o">=</span> demo
</code></pre>
</div>

<p><code class="highlighter-rouge">hosts allow</code> is the source host ip address</p>

<h3 id="source-host">Source host</h3>

<p>Prepare two files:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ls -l
total 8
-rwxr-xr-x. 1 root root 175 Nov  2 13:51 rsync.sh
-rw-------. 1 root root   9 Nov  2 13:47 rsyncpass
</code></pre>
</div>

<p>For the shell script:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>more rsync.sh
<span class="c">#!/bin/bash</span>
<span class="nv">src</span><span class="o">=</span>/home/demo/source_folder/
<span class="nv">user</span><span class="o">=</span>demo
<span class="nv">ip</span><span class="o">=</span>2.2.2.2
/usr/bin/rsync -zr --append-verify --delete --password-file<span class="o">=</span>/home/demo/rsyncpass <span class="nv">$src</span> <span class="nv">$user</span>@<span class="nv">$ip</span>::rib
<span class="c">#</span>
</code></pre>
</div>

<p>For the <code class="highlighter-rouge">rsyncpass</code>, please make sure the read/write access only for the current user. It only contains the password.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>more rsyncpass
demo
</code></pre>
</div>

<p>Now we can put the <code class="highlighter-rouge">rsync.sh</code> to the crontab, done!</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>crontab -l
<span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> //home/demo/rsync.sh
</code></pre>
</div>

<p>You can check the results from the target host in the target folder.</p>

</article>





<section class="rss">
  <p class="rss-subscribe text"><strong>Subscribe <a href="/engineering/feed.xml">via RSS</a></strong></p>
</section>

<section class="share">
  <span>Share: </span>
  
    
    
    
    
    
    
    
    
  
    
    
      <a href="//twitter.com/share?text=rsync+tutorial&url=http%3A%2F%2Fciscochina.github.io%2Fengineering%2Flinux%2F2017%2F07%2F06%2Frsync.html&via=cisco"
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
        <i class="fa fa-twitter-square fa-lg"></i>
      </a>
    
    
    
    
    
    
    
  
    
    
    
    
    
    
    
    
  
    
    
    
    
      <a href="//plus.google.com/share?title=rsync+tutorial&url=http%3A%2F%2Fciscochina.github.io%2Fengineering%2Flinux%2F2017%2F07%2F06%2Frsync.html"
        onclick="window.open(this.href, 'google-plus-share', 'width=550,height=255');return false;">
        <i class="fa fa-google-plus-square fa-lg"></i>
      </a>
    
    
    
    
    
  
</section>




<section class="disqus">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = 'ciscochina';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



</div>
</div>

    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h3 class="footer-heading">Cisco China ADC Engineering Blog</h3>

    <div class="site-navigation">

      <p><strong>Site Map</strong></p>
      <ul class="pages">
        
        
          <li class="nav-link"><a href="/engineering/about/">About</a>
        
        
        
        
        
        
        
        
        
          <li class="nav-link"><a href="/engineering/blog/">Blogs</a>
        
        
        
          <li class="nav-link"><a href="/engineering/typography/">Typography</a>
        
        
        
        
        
        
      </ul>
    </div>

    <div class="site-contact">

      <p><strong>Contact</strong></p>
      <ul class="social-media-list">
        <li>
          <a href="mailto:penxiao@cisco.com">
            <i class="fa fa-envelope-o"></i>
            <span class="username">penxiao@cisco.com</span>
          </a>
        </li>

        
          
          <li>
            <a href="https://github.com/ciscochina" title="Fork me on GitHub">
              <i class="fa fa-github"></i>
              <span class="username">ciscochina</span>
            </a>
          </li>
          
        
          
          <li>
            <a href="https://twitter.com/cisco" title="Follow me on Twitter">
              <i class="fa fa-twitter"></i>
              <span class="username">cisco</span>
            </a>
          </li>
          
        
          
        
          
        

      </ul>
    </div>

    <div class="site-signature">
      <p class="rss-subscribe text"><strong>Subscribe <a href="/engineering/feed.xml">via RSS</a></strong></p>
      <p class="text">Cisco China ADC Engineering Blog.
</p>
    </div>

  </div>

</footer>

<!-- Scripts -->
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js"></script>

<script type="text/javascript">
$(document).ready(function() {
  // Default syntax highlighting
  hljs.initHighlightingOnLoad();

  // Header
  var menuToggle = $('#js-mobile-menu').unbind();
  $('#js-navigation-menu').removeClass("show");
  menuToggle.on('click', function(e) {
    e.preventDefault();
    $('#js-navigation-menu').slideToggle(function(){
      if($('#js-navigation-menu').is(':hidden')) {
        $('#js-navigation-menu').removeAttr('style');
      }
    });
  });
});

</script>





<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-5530101703628975",
    enable_page_level_ads: true
  });
</script>


  </body>

</html>
